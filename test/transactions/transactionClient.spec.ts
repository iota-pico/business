/**
 * Tests for TransactionClient.
 */
import { IApiClient } from "@iota-pico/api/dist/interfaces/IApiClient";
import { Address } from "@iota-pico/data/dist/data/address";
import { AddressSecurity } from "@iota-pico/data/dist/data/addressSecurity";
import { Hash } from "@iota-pico/data/dist/data/hash";
import { Input } from "@iota-pico/data/dist/data/input";
import { Tag } from "@iota-pico/data/dist/data/tag";
import { Transfer } from "@iota-pico/data/dist/data/transfer";
import { Trytes } from "@iota-pico/data/dist/data/trytes";
import * as chai from "chai";
import * as sinon from "sinon";
import { ITimeProvider } from "../../src/interfaces/ITimeProvider";
import { TransactionClient } from "../../src/transactions/transactionClient";

describe("TransactionClient", () => {
    let apiClientStub: IApiClient;

    beforeEach(() => {
        apiClientStub = <IApiClient>{};
    });

    it("can be created", () => {
        const obj = new TransactionClient(apiClientStub);
        chai.should().exist(obj);
    });

    describe("getAddressesByIndex", () => {
        it("can generate index-based 1 addresses with checksum", async () => {
            const obj = new TransactionClient(apiClientStub);

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesByIndex(seed, 1, 2, true, AddressSecurity.low);

            chai.expect(response[0].toTrytesWithChecksum().toString()).to.be.equal("WUQMPPKFDR9IIGRLDBETVTMGTLYLPTKICWKMNZNBYPQDNQ9YTTOPYUBUYFQEALBRTEPRUFHWOVY9NCW9DE9WXEIJWC");
            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("SAYJVKKLL9YKEEUSQFKCPUUEXADXWTQYFSCJOXDPLVGUXCTHKRRVUUSMGYOAPKT9YXCHRJWDTTPZGE9BXVLRXSAJZX");
        });

        it("can generate index-based 1 addresses no checksum", async () => {
            const obj = new TransactionClient(apiClientStub);

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesByIndex(seed, 1, 2, false, AddressSecurity.low);

            chai.expect(response[0].toTrytes().toString()).to.be.equal("WUQMPPKFDR9IIGRLDBETVTMGTLYLPTKICWKMNZNBYPQDNQ9YTTOPYUBUYFQEALBRTEPRUFHWOVY9NCW9D");
            chai.expect(response[1].toTrytes().toString()).to.be.equal("SAYJVKKLL9YKEEUSQFKCPUUEXADXWTQYFSCJOXDPLVGUXCTHKRRVUUSMGYOAPKT9YXCHRJWDTTPZGE9BX");
        });

        it("can generate index-based 5 addresses with checksum", async () => {
            const obj = new TransactionClient(apiClientStub);

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesByIndex(seed, 5, 2, true, AddressSecurity.low);

            chai.expect(response[0].toTrytesWithChecksum().toString()).to.be.equal("GNHOKBJGTHASHZCGOVFRSDTLVZHMREKHZESIOEJMYI9P9INKUZXKLW9P9KFHSUDBPVDIWILOHLLDRXVSDXCAMKD9HZ");
            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("LFVKRMYLAEDJBGQU9APVPZIFKVZUEMGLTDYBDTEUHRNCDNODNCOLAB9VXSZTHMXPVBD9DSVHUPPUWCNS9IVP9OKKHD");
        });

        it("can generate index-based 10 addresses with checksum security medium", async () => {
            const obj = new TransactionClient(apiClientStub);

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesByIndex(seed, 10, 2, true, AddressSecurity.medium);

            chai.expect(response[0].toTrytesWithChecksum().toString()).to.be.equal("NDZNIIRCKGY9X9KLJFYRXNDUYVMTAXEMWHNHUQ9C9X9RICXIRRIYRWYXXDQAGYCDVC9GSASO9FGIWKN9XKIUDXZZXZ");
            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("LENQNXNREDKHEJBKSOJABZIVZQFGTBRVAMMDVPI9FZF9QWXWQK9FMRIBKPIUOXPGMMYGGZIMEWHHUBCZWSNODDUTAY");
        });

        it("can generate index-based 15 addresses with checksum security high", async () => {
            const obj = new TransactionClient(apiClientStub);

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesByIndex(seed, 15, 2, true, AddressSecurity.high);

            chai.expect(response[0].toTrytesWithChecksum().toString()).to.be.equal("LCNP9HTWETYMYCCEVUTKYDCGGWCAVUZYTYCCLBRIGCQNMBWVUIQKKVJOKZWOKUTMMKTMWPZEPJHMKDVMWIVTRDEWXY");
            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("YXVZ9LBTIXBAVBQBBCEXIJOGIZVBKKQSIFQIA9RMKL9JDVWOVWANEMDZGZBJLWIAZHQATFNAFPFKUXZLBXZMSORZMW");
        });
    });

    describe("getAddressesToUnused", () => {
        it("can generate unused address where not spent from and no transactions", async () => {
            const obj = new TransactionClient(apiClientStub);

            apiClientStub.wereAddressesSpentFrom = sinon.stub().resolves({ states: [false] });
            apiClientStub.findTransactions = sinon.stub().resolves({ hashes: [] });

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesToUnused(seed, 0, true, AddressSecurity.low);

            chai.expect(response[0].toTrytesWithChecksum().toString()).to.be.equal("UHUASCSYJQOCABTJAJKVFPIUDTXYPMSJTKICSGJOVKAEDBGJBUXHNTKKMNRHQRKVGPPFKQLP9VNXJOTRBKMJGYCQBD");
        });

        it("can generate unused address where spent from and no transactions", async () => {
            const obj = new TransactionClient(apiClientStub);

            apiClientStub.wereAddressesSpentFrom = sinon.stub()
                .onFirstCall().resolves({ states: [true] })
                .onSecondCall().resolves({ states: [false] });
            apiClientStub.findTransactions = sinon.stub().resolves({ hashes: [] });

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesToUnused(seed, 0, true, AddressSecurity.low);

            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("WUQMPPKFDR9IIGRLDBETVTMGTLYLPTKICWKMNZNBYPQDNQ9YTTOPYUBUYFQEALBRTEPRUFHWOVY9NCW9DE9WXEIJWC");
        });

        it("can generate unused address where not spent from but has transactions", async () => {
            const obj = new TransactionClient(apiClientStub);

            apiClientStub.wereAddressesSpentFrom = sinon.stub().resolves({ states: [false] });
            apiClientStub.findTransactions = sinon.stub()
                .onFirstCall().resolves({ hashes: ["AAA"] })
                .onSecondCall().resolves({ hashes: [] });

            const seed = Hash.create(Trytes.create("JCGUED9XQWAHWHJUIYIEYSJVGNQLJSGRSUQCEBJD9NQLZIZQGVDILVNNEFWLSCIPEBZTYBJYXWMJOEEZW"));

            const response = await obj.getAddressesToUnused(seed, 0, true, AddressSecurity.low);

            chai.expect(response[1].toTrytesWithChecksum().toString()).to.be.equal("WUQMPPKFDR9IIGRLDBETVTMGTLYLPTKICWKMNZNBYPQDNQ9YTTOPYUBUYFQEALBRTEPRUFHWOVY9NCW9DE9WXEIJWC");
        });
    });

    describe("prepareTransfers", () => {
        it("can prepare transfers", async () => {
            const timeProviderStub = <ITimeProvider>{};
            timeProviderStub.msSinceEpoch = sinon.stub().returns(1518782585);

            const obj = new TransactionClient(apiClientStub, timeProviderStub);

            apiClientStub.getBalances = sinon.stub().resolves({ balances: [43] });
            apiClientStub.wereAddressesSpentFrom = sinon.stub().resolves({ states: [false] });
            apiClientStub.findTransactions = sinon.stub().resolves({ hashes: [] });

            const seed = Hash.create(Trytes.create("ISHKSEIVNKYFLYAUKVDRAWEUIZJIAAVICHFCIAEEUPSIJJXTLOLVJBZWEISNBVQLQJCSHCAUAFMATP9KN"));

            const inputs = [
                Input.fromParams(Address.create(Trytes.create("GGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICD")),
                                 AddressSecurity.medium,
                                 0,
                                 43)
            ];

            const transfers = [
                Transfer.fromParams(
                    Address.create(Trytes.create("YWFOASPRMMHRYPBTSPMRLZRUPQRUXXCXZRVTBHXETBUJFZXJVDHHLORPNECANTVYCTEQULGJXELPVNJGBKUUNDKVMX")),
                    5,
                    Trytes.create("BLAHBLAHBLAHBLAH"),
                    Tag.create(Trytes.create("THISISATAG"))
                )
            ];

            const response = await obj.prepareTransfers(seed, transfers, inputs, undefined, AddressSecurity.medium, undefined);

            // tslint:disable:max-line-length
            chai.expect(response[0].toString()).to.be.equal("999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999PSTBGFZXBMTWL9JMOCPTJWO9GUDMJYMUJZ9IHLANBIEXVOWD9THLDYKE9JDIGKMPKGPOTOXPCNSDZKVGXKA9999999999999999999999999THISISATAG99999999999999999EJDWC9999C99999999C99999999XBJWKALTWCWWKDEDBBWHZXLQKRZVZJLFLFLQZJRBBSXDOEPX9QSFWLVCDODGRIAYL9FRCSKRQJHUDHPIC999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[1].toString()).to.be.equal("YGGXHATQITGJFXTYXTSZGUNIFJYQQMSBUMCUPUMIVZNKQGPKPPHUW9VUTQRU9PEJFXVVZYHUMAOQKS9KBMUTHGZVBDN9ZXDSXDKRPFWTTQSEXCZJVKOOITJVVMGTNINPIYVJWAFYAYTMWN9VIAWVHMABAUQFMFTXQWTSUBS99ILK9EDCVIFJXBSUWCHUQTMQLHFWCSYRKPPTCDKGKXG9AIH9HVIAPOFOVFGZPDQGPA9AWVYGPIWGHDMAAUDAQPSEXQAANRWLYSKVWGNWMWQUVMGFVCXNYPTXLFCB9MEQUOHACNUOZVKSWMDIC9VJKGCMNLZ9XJS9VAUXFLJUMDMPGLOIPANXIHNVUFZESIJNVBEVGBYGWYLNX9GMQXHCIMBWIFWUZVHWMP9TPBMCFK9VCIHPXDPJSVHOWF9FZKETGHUAIRJQZMJIDLHKZTGLTRQXSUXEEXEKVMPZLATCCMNDYPDQBWUDFTXFRRBS9AEGTIKFZAFQKGVKLLANESPDXUUMEUM9IMPQVUUKGJYMFDVUEFFUXHTJE9TPIBXOFHHMTGJRBSUX9LBPFXXJ9SSXPQJJUCAFZNXSLMWWPJVLLRNBGOQ9HVNAECPGLCFGMWQP9ZECEW9UECDOYEIWEUVWFL9FYYOAKFMDDYTOTEASTMZA9FYLB9HPZWVFSHYOOWTQ9LKZSDTPCRGRHOYAFBNSWISXFVNYHOEDZGSRPQTTMZBDWUVCWXUSJOTRGZRCZGYWJCDTYMFHGWYBQXNDMIEQ9HNSWV9RBFGUNRKCUNDRAAVVBJQWUGFWAUNGJP9TODLGZDXTHRIJBJOTGQMGPOZKK9KDYLRYHIXWOCFOIWOUUDPOJPFFDNQVCSMAXPNLPUEDOZKEHZMTRLHEAOJRSSDUVVKCDGWHZYKVKTZXYKJUAEDVNGENJWX9XRTYTZUWSXT9ZIRYKHDWIARPSDPTZLQOLWJ9YHIKHMYGBMTWZJUJJQPOXZJQTVQGUHSIXVUAISNVAFUTLYAS9ISMMYD9LLTJTJNYGZSTFUYJKNQDVSWKIMCFFYSFXKEV9GYYAQHBCTEMBKH9BMGJICLAIGWICSTAWC9EDIRLKNRX9CUTPHRF9JLOTW9YTGVQBIKZBCXMHDMSREHQTZTOALYKXTXTTILGBRGMHC99GZHHCRIT9KGUJYJLSSUMRFSOXLCTRAFUPEJSDWSOHYJQBPVAOZBLAVGCOBDVGNKPJKLAWMHWS9AVKWMXDEZCYPMNFXQPHTXNAYUNXF9MTGSAXYWMQFBFAXXIVISHEEVVBHPDLLGCRNEWTMTC9CUWKXDXBEULDPJPZUESC9BZVPILKVFZVFUNWODKPKYJ9BR9RSRDQPNGMIKFRALTLFNJETRYROCTBVCFXLNDPVETVJHJTQYES9IPDQCJLMCQXPXLEIKTIAVERSXMYGGHTCPJBVTTIUWIAWKCLIFKCEIEGVTPSZYETSCQLVTLIJHDNXVDTTLLMLZFJ9CAKEFIKSYESOZ9TJEHTJLTPHQV9TAFDXSSHRZCYKPOZ9VXKZBJXWZWWWHKLOUP9CEOZXDVRPHMLFJQOUIOJSBZMRNGMMPRVFUKWXBQBAVVFRAIWMNWVMUKYSVA9IBPHOCCMOBDYSTYZSFTZTTYOWCTJMVYUAFE9JWKEPCBNTOMIJYVYKLYHVFLVJBVGLRJIGMBSK9HVGNCUNHMQMOEGAWZZRORGTOAZA9NNKXISDDQEELSLVQ9XHYFDLSNLKWGLTKDJJEVAXBCDKQJLJQVIEUMDTGMNMCZBI9FNDCEHDJJWQDWKFGMUEMUTDQPUHLLEQXQRQAWXRHDDPYHXBTYCUEHEVJSVXGWPGIXPJWBYWJOVKDXSNF9WQKHKA9X9CHOTSWNWIAAYQUTXVTMEPDJHX9ZMURDOQCC9RNYQKQYMUSJLWPHQNPXYWUGLBTAHFBVGHVSJSTBXQVBN9UC9MGHEKD9WLRKHZZZZJRNNTLFUCGZWSOMYUHQHUDIKUSQBCFYKTDNU9WNKKWD9XVSWGYASRYISLCU9HXKODOLSQZYUA9AMJRUZCFYKDHKQJWNWPWPNLYDUNOKWHTJDCYASUTFJWOPZNUYEBAN9YWWCVNNEZE9ZW9RCGPDFAKXRRCNBTMOQDARIVZRMLNJ9OXCGWRHYSGIIVZQRAKLVQEPHJWFCD9BAIOZGGEHKWPEEFXZOGYGGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICD999999999999999999999999999THISISATAG99999999999999999EJDWC9999B99999999C99999999XBJWKALTWCWWKDEDBBWHZXLQKRZVZJLFLFLQZJRBBSXDOEPX9QSFWLVCDODGRIAYL9FRCSKRQJHUDHPIC999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[2].toString()).to.be.equal("NJTUZNAHHFRIUGQVMZQUJOHXITWTOAITPDFFKXKSNBOCJBBWZKXIXZUVQIIXNKFFPWYTPIXXHWIVHVSPZOBXRQCSKWOJPYFTBWZCFALTXWDNJZOFNTHBLUOAKIQJRODDJYMEKTKGBCUQZAMLQ9CQEFKFJYSHILDBTAVWSWATHRJDZMZRBKMSOYQGNRWOQRMU9FI9ZCJZUTUICBZFHUIIMAGNHK9TLCVXCYEKJZAYTUBGBRWOOZZLLTQAAERF9VTESVQKHQPSRQXUXLYMOTAXOUB9VWPHLQRJZXHTZDUGORJXYXGFZWVTFZMDJNTNG9EZIMRXSEXOFCABWOZN9RKVYF9KCKV9WIGL9ZSWYWOPJOLUKZUNJBMAKPMPBGGYZYLEFPXEBOUYBCTUQUZXOOIYXKBKIAKVRKLJZMRVMWJXJNPAOCJYISAJVZKVQDTFOJHUJDJGDBJNXTDERIVTNHUCULTPJAY9WNWKSSEYD9EFRUTTRDIIBDCQMWVZYSPRRRZGKANSJOIQNKPHQLAYW9BGUNRGUXKYVKIWDOMUBHBNWCEVNVRPTZMKXPXARKHUHBHNGOPEMDDJDWHHSAXJVWZJUQC9JVWHUOFQXVVLKUGBYMVECOQYWVIQTVLMVSZAIITHJFOIUSBBPKVFTHQFYGOMMDLHJVCFXNUKRHQOQWAONCPGPXIZUICISJRNTMTJW9FWJWWRMFCGCQSPLWHDURRKZEEG9SGYOMIWLIJ9NOQD9WFHWAJV9SK9YIQLQVTWITKXARWDMEBXLHDLW9TNMCA9ZKTTVYWNNQ9ZIVRHLVSEVCTLZFQGLAX9DFJXPDT9DPBWYGODIRVPQMZYGNCUJDTFQOZNHSESILGVTYQU9BWEQDVQTXIACJYIZACTGXWXFKNWUUJJCQWLSBDVHWT9DLYMXLHGPJDXRSEM9WFPNPZZBZPXXUKRBEVNXQYOS9NGJKDZSEXWQOUUILFDPBQIPRLMVISKZBRWCTMXSDOYHXYNJA9WMMMVQDWEPJVLDHXOGHBMWBAFFFVERYDKUHDPHFEVPPXWSHY9ZAVCXWUKKGNMHS9SKDDDPFAMALSILASFB9CLHZBRD9LBFFTTQTDSTCLKNKIUKRQQMOIVLEZHUBSNEXU9NAZLOYV9WUXM9YYZSJXUGAWGSBNDDSPIXHBRCZX9FXSWQDVPGAKLHWAWKUUMLLSQFNCHHIRCSPMPFSQETVWQUHFVOY9BPGYOUMU9A9KFZVPCNGHXKLQUFJAFGJPUXAIJZENLM9OONPBYNJVQQ99YUIZCDOKPB9JLLFE9EFGC9WHC9BXXONEZMBMXDDLOKNBTSMIAGXIRLRRSJBGCCKRSNUHKJXO9SY9JIXWW9WPXFRLMVFVJITQEAOBXRAIOCXTSODXFRYUZIVMNDZOPOXMTDPWZEDPXUMOSEYLZZZK9LTVAHAIYLPLVAPMVHEV9PSUVQOUTQ9LKWHBYWMPLKGQELSBCWSWQLVITY9HB9Q9AUCULQSB9EFTVZNRPRTRZFQTBVNLAYBUEITRPRJDKSTI9TRBVZEADHLYJEOCZPCTGPJFJUJ9VJMZTZJ9LSLZUZKLRPIYPLSWAQPSF99EJAYWKZL9BZEDDJSZRGK9EKSKCWXMTLIWKUI9HXYWOTICQEJMLVUAITJPTEABKN9UUOWUIXOVKCDSBMM9JZ9UXESZFW9OHL9XZHUDOKMAYYXMQMPPWHEKOYFJXOEKFTFED9L9ORNFYNOXYLWSWHHLXFLARFIAJNYNQYHONAOXGFTZSFMTRR9NKLLRVEBAEP99QUBEKCILEAKXHZSWRYYSGNTSQTWFQVHF9LWABOKPDTGTSRHYNWWGJCIPMFCBLETMSBVOGQXTO9TZMIAHHGFWEUMW9WJADFWDLIDEELTIGOO999ARKDQQQURJVISYEOJQKPFSZTIDUOTHOWXVUSXWOGQDJHGPDQXSQZGKHWXXCYLUJYRTRVAWYBTYKURUXSR9CFKSFTTRYITBZLGFPYNEWMAFTBIRKHIPRTMFRPTDZCPGDBLVUOOGHTPDQXXQQHLTSMKYMIWVSNIOI9FLCQTWBIHNCLNVFYYDJXZMDA9TRBFKVKVGOLYPYZBSQBLRGSZNYR9TQSWMJPGPUHNZIUVJXPWHUGLJBLJTPSXABBUBJEFMFMNANKYXVCRVJBBHJXPOUCZCDTJREIFKDJMBGGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICDKY9999999999999999999999999THISISATAG99999999999999999EJDWC9999A99999999C99999999XBJWKALTWCWWKDEDBBWHZXLQKRZVZJLFLFLQZJRBBSXDOEPX9QSFWLVCDODGRIAYL9FRCSKRQJHUDHPIC999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[3].toString()).to.be.equal("BLAHBLAHBLAHBLAH99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999YWFOASPRMMHRYPBTSPMRLZRUPQRUXXCXZRVTBHXETBUJFZXJVDHHLORPNECANTVYCTEQULGJXELPVNJGBE99999999999999999999999999BNJSISATAG99999999999999999EJDWC9999999999999C99999999XBJWKALTWCWWKDEDBBWHZXLQKRZVZJLFLFLQZJRBBSXDOEPX9QSFWLVCDODGRIAYL9FRCSKRQJHUDHPIC999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
        });

        it("can prepare transfers with hmac", async () => {
            const timeProviderStub = <ITimeProvider>{};
            timeProviderStub.msSinceEpoch = sinon.stub().returns(1519037971946);

            const obj = new TransactionClient(apiClientStub, timeProviderStub);

            apiClientStub.getBalances = sinon.stub().resolves({ balances: [43] });
            apiClientStub.wereAddressesSpentFrom = sinon.stub().resolves({ states: [false] });
            apiClientStub.findTransactions = sinon.stub().resolves({ hashes: [] });

            const seed = Hash.create(Trytes.create("ISHKSEIVNKYFLYAUKVDRAWEUIZJIAAVICHFCIAEEUPSIJJXTLOLVJBZWEISNBVQLQJCSHCAUAFMATP9KN"));

            const inputs = [
                Input.fromParams(Address.create(Trytes.create("GGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICD")),
                                 AddressSecurity.medium,
                                 0,
                                 43)
            ];

            const transfers = [
                Transfer.fromParams(
                    Address.create(Trytes.create("YWFOASPRMMHRYPBTSPMRLZRUPQRUXXCXZRVTBHXETBUJFZXJVDHHLORPNECANTVYCTEQULGJXELPVNJGBKUUNDKVMX")),
                    5,
                    Trytes.create("BLAHBLAHBLAHBLAH"),
                    Tag.create(Trytes.create("THISISATAG"))
                )
            ];

            const response = await obj.prepareTransfers(seed, transfers, inputs, undefined, AddressSecurity.medium, Trytes.create("MYHMACKEY"));

            // tslint:disable:max-line-length
            chai.expect(response[0].toString()).to.be.equal("RBCTPJZUSPILJHQWBNUHY9IJJYPXBJKBHVXUFKNUKFEXGCBRAUQAWLBSWLXSWAJPJTMLYXDMIQJFJCHGS999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999PSTBGFZXBMTWL9JMOCPTJWO9GUDMJYMUJZ9IHLANBIEXVOWD9THLDYKE9JDIGKMPKGPOTOXPCNSDZKVGXKA9999999999999999999999999THISISATAG99999999999999999PJCIWYD99C99999999C99999999EXKEJWSQAXRUGLEAKUEYDOGXKBSNWKWDAX9VLILZGRLZWQIZRZRWESRXJCLLFVBPJIO9SCBNPIJRELWJZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[1].toString()).to.be.equal("DZPMLPWELYTPXPEAXFFK9G9IWSOPJWDAHIRONVWVXRGZKUFPPZCUQCNBTGNCB9XVAZUHRLQVMDAD9KXMYOMSDZMKLXOWBLGEXMWOFZQLFQJMOMZCCSPZIAKXCDNPYGYEZWFJP9WBPDPXRLPYPPWTXJXHPNHM9HMZHAZTYNCKCTIEUIXCFTNXEEC9BFWXMATSGBAOYWSNMNC9DXLTJCTPAORFAGBTJNSOXOCQDBYCPXHWPNCFGFWLHLR9XJRCCJUD9AUAWQJIADIGYAVKDBAQYZIRIQWUGIJDWQQXBQPEDBXAHEATNYGAGCANYUK9GWBHW9ZBYBRAWWMDQPJQFZXJQVOKLAYWJHRNCKIHDDQHFKFSDZCDNSDIRHQTP9ZQLYWIDDBFRYRBQKTNKDJNLMFVDBACJIBUXKGK9FGLMZNHHNHNYBINBFWKFFRILMMRTVEVHQKZXQMJBHYECPRVN9U9TALDHEWKETPTCONHNWGEUHAZOXWWXXVOOBXBFSDTBNYM9KU9TPGQVVZTVNHCWAMNL9LGDRSDVSOZHCPNTNILYM9JKBDHEAHYXFXDJWUIARNFRLMHEYCZQL9MVSDTPCEEYDTX9HOQRIFSKAFSCFTQH9TXRRETCQGYZUEAMAKOVXOQMDDLUOYDQLDFOKUNLDA9AWOGZPZYVZVPKDTQHZMFTMIPPXEQKCQCBYHTFUOVDNWGYPQDLJMFTSGTSKQFV9VHSGWNZKMDVXGKYCPCGMN9XREJNLVAXJPNKILKBS9AQOFOJOKFQ9IJLSLAEGZHGMYKXCMHVCUTXQOO9JCWMOUBYWVOQOGWSSSYQUMWCEUTJLWKSIECOQDPOUKJALOEPLDVALVLCVMAKKSROUL9BG9DYIMXFHIKNTXIXDIDIJAJRJAVBCYRZIISYATBYPLULADUVLVNXHIVMAECEHGMRIN9FGPTMNMBJSPNRNURTHSQWAMXFTZQAQSZBXKYMYAIUDYMJNURIJSNJQNFZCXXQBDAGZCC9JZQVCTKIYDZSFXSXNBGLMKJR9MNVHVYPPESBDDRFALPDUMAZYQBFRKHS99RVLOF9PEERSHUAGQYGWLGUFATKYCIMMCTYLIXVMEAYJENNK9ZEPWTIOAYQLIITRQQSLRFLZXPOGIVHNPNZFDNYDWVOLLYR9BTCHSLPDCZCBRWAFPZCHCWEHOHMMZRWWLE9MNWIBFNWUJZOLDKEYNIJE9VZFRWAQZNVHZHCTWABBQDWXSPSMKIKKDAUWMVDHJQDJLFJVXITCVCCHP9SRBERCOMFFBAGPJNDPECJSKAT9RDEGDKVZRABNWPYXMVJFRZHQPUYEDXCVNFWZGRS9BXEJ9VRASZRE9KQFHVEIDNETD9QRDN9HHUFOVSDWX9UYGRTJTWAYFDVTZZNELQKGRBZHJJLVCPXEZEGWBE9FQ9VZOVYAMMYKGQEOXPROCYDAPXUVMXGQHLZDDP9ZTRTSAMABXSBFHPCVURHSLUTZIGPGQRCFSORFLYYUASABOJNIPJOIUCIFQHFLVEOGAPCPEBYFNJCADKJCNOPIQOCLXOKWMDHPCENORQYUOZFVHUDNLECSZEOBHGXRY9IOJYDSIVHGJPPCPJHRQLDHAG9VIHJETWKFQABRPXJFDK9GIXZIZCBVFANXDLBWECMOBN9UBLWVTILDRCOIEEUZVDEUWLHMGTUFUTRPNGQMWBNYJVWNYTHOOOJSHDXGBIFEETQNVXWZLGEDWW9KCYOEODNZKQXABHYDBOZFDEQIOME9LXJZRGRBRLOZIMGCUXYDOOYKWR9DNMSJBF9FDJUHGP9ZOUFVBOEUUMYKAT9YDNZ9OZRPJBWD9ICQOZ9RLBHFNYDQKUA9BNJXVBJRXFHTKDFOHA9PUNBQCWOUKQIVCHQSECZLTWVHNMEHWJLIZVHKLP9SASNULKIYQMINLAQPRBJHQKCVGJ9BIZDYNUWDLMFSPADPJLBDZRG9FZONWYVLXGUIHSNQYYDBYCC99YZXDGPYBO9FDENWNKUDTFMZTV9IHPROWVDPK9XPUMFVEXIRTGKKBPPHP9DFVMUONPSWJTQKDXGJRWECVKSLYSQSDZZQIZKZPOTVEGFXJS9ANVI9NMNXZIIIYOXIWDLAIXLBYTVIVNOOGHIOOBYHMEMEGCURDUITQOWYBPPPMDLVABCIOJEADACGALWHYRHKLIKYYGGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICD999999999999999999999999999THISISATAG99999999999999999PJCIWYD99B99999999C99999999EXKEJWSQAXRUGLEAKUEYDOGXKBSNWKWDAX9VLILZGRLZWQIZRZRWESRXJCLLFVBPJIO9SCBNPIJRELWJZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[2].toString()).to.be.equal("NJTUZNAHHFRIUGQVMZQUJOHXITWTOAITPDFFKXKSNBOCJBBWZKXIXZUVQIIXNKFFPWYTPIXXHWIVHVSPZLBG9XZMXAFLLCOSNMNJEWJBXRNTLGWDEUTCXUHJGSAN9D9VYPCRM9KOYA9TQKEHCRJZXEDKDRJE9SWAMB9TZNKKISRIKONBRNETWCSDDOBJNYEISM9DIGYCSIOYOAJLVYXMKLLGSAODCSPHGJLOPIKAPHUQYQGLXUDAADWYBFFXQHHYWQDUNURGO9ZKVDNZRFPZOMEKOJDNGCIPKHSLUDLTND9DUA9KHMGGWKPVEJWISWK9QHXYAWRL9SRBYTTCVYTBMQODLHE99QRXFQZX9GIRHMNKK9ENEYZTI9CJGQAAILWIULPVCNLHNICWDOA9UB9ICOSWOZDWELRJVKCIY9DU9NRAOBVGVHZNNJBPQDTZEBAAWGGMUJJVJKHZGNZJUOOTA9WOJAZCSWNJCJYUADRIKXTWEXFEVWYKUFYTEHGLTZQALKHVYKMUABPDHMGAHFFLADMSCNIGLFZWHKXAXFXQFPMOZZRFYOOSG9BSSEYNRITYUUEABNIPAFRQUADWDBPMTBELSBOYRONFWPUUSFC9PPAIRVCAZ9LUFMPFYNDIVSUBPKRNNPRWBXTXFZWVDAPPRIGGHNDYHHUUCNTNSCXWMYDNEFZU9CCTVMEEKPFMLMHBTJGKGXKNFEZAQ9PM99CMHTLEZZO9MVPRSNNYGWXPCWG9IYBYHRVSRATKQAMKCWSZZHINOTGYUBVNLCKRTYMQZXWOJV9PYMEMENNRLDGURDPWHCTD9MZJTVHIWTZOP9LGJGZYPJLQEVDYZDVWKHVUULXISTZKG9JLJPWHNYHWPCLIQJEKOPUCCXHWGODWMPCKKORFR9NCARMPVJJLLAOROTNHDRLZMTYILTK9XWGXIXHYCXTMWFHNQ9WNRMYPKUISTJCNUBHRHAZXRLR9FZLKNVYOEJHCLAYECDWR9PCYFTCS9HUYLMZFDKGYJXSG9AEJVKECRDGLUZQHMLJHCZQKIE9RHCTPXGCFH9QEFZOYYKOMYWKDCONBXNKQEFIKIIZNHJNCKXWVSFOOZPUEBSQYKTXRZDYWCIYCRJ9IMDT9PQGZKWZLOYV9WUXM9YYZSJXUGAWGSBNDDSPIXHBRCZX9FXSWQDVPGAKLHWAWKUUMLLSQFNCHHIRCSPMPFSQETVW9NLJUBBKUHALLTAVWFCRJUQADHDOTJBXPWUKCECIXDAQPTHORNFDIMAGGTVKKLYMCFGEHB9SALAKOWEODRCC9SI9FQDVTFPXEJR9NPNPEC9YKEOALC9JMJRCFWKHLJ9RSRBGSZBUBLYDFPLWK9XIAXKZLNXX9FONQDMDDSNLG9GRXUEADMSSPUWH9NQAWNZFHULCOSYESVCYWO9PYYB9SSOJETKE9KEJGDEZNTOKFHGZMIFQXQWMMVHXSPAHE9YDRFSFJMCNVKRZSJQAAKDRZDSKOVBVREKYBAVDBLTIOAHODCV9CZEPHRMVIKTQMKPJL9CCUPJJTHTWQASJE9KQBMF9XPAAUKP9PZHCZBETLTPGOTIQUUSCLFNUQHLBUQVWCPXOCWNIQC9XSK9JKAEGZP9NGNRREGDEOQWTYOWXGJEFQLSVTOIZYCUEFBVZPXSJDXTPOVRZAIHXMEJFRVUREHEYDJSKRXQBWU9FCWVJOISDBWYNMHMU9QUALCSDKULXDSOCXPUMJCAZQEMQWXBCQZBAHMJCROH9MTUADZNXRAJEDXXJI9UEGYWQYZRQRNCZVNKYCNNJTUZ9RUDDZ9TUCSOEGCFJADHUGGTFSIGNXNJAREHUGKOCNLPYYFPVGU9PACBQEJRWBLIZJDHBHWPZAZVCGRHDFMWDXKSGSJMLENKPFELFLCXCANKBOWTCEBXPZISGZIXRHVHLBHTAECLQBC9UZQXSQZGKHWXXCYLUJYRTRVAWYBTYKURUXSR9CFKSFTTRYITBZLGFPYNEWMAFTBIRKHIPRTMFRPTDZCPGDBCYMYTOT9BEXDFWCLJIOWLJNJDMZCXXUJNUDKS9AN9PWFGNBIBIXP9FCIWMVQM99VCLFOCXHKDQVNKIXFCTNCFAGPFPZ9NZMKQNQ9ABPAJ9QZVWQNAWGXCKLOJOGEIDIRZUSXPY9TGZBRTNOEJTQYZBLNKO9MNGOGEBGGOUIA9VBWFTAUGFMEYYGYMOVBGT9XKBELVEFVWNKTRIUYGGWPTBJNSKOBNJGAXRGHHAZXBXZKLHTPICDKY9999999999999999999999999THISISATAG99999999999999999PJCIWYD99A99999999C99999999EXKEJWSQAXRUGLEAKUEYDOGXKBSNWKWDAX9VLILZGRLZWQIZRZRWESRXJCLLFVBPJIO9SCBNPIJRELWJZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
            chai.expect(response[3].toString()).to.be.equal("RBCTPJZUSPILJHQWBNUHY9IJJYPXBJKBHVXUFKNUKFEXGCBRAUQAWLBSWLXSWAJPJTMLYXDMIQJFJCHGS999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999BLAHBLAHBLAHBLAH99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999YWFOASPRMMHRYPBTSPMRLZRUPQRUXXCXZRVTBHXETBUJFZXJVDHHLORPNECANTVYCTEQULGJXELPVNJGBE99999999999999999999999999PJISISATAG99999999999999999PJCIWYD99999999999C99999999EXKEJWSQAXRUGLEAKUEYDOGXKBSNWKWDAX9VLILZGRLZWQIZRZRWESRXJCLLFVBPJIO9SCBNPIJRELWJZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999THISISATAG99999999999999999999999999999999999999999999999999999999999999999999999");
        });

    });
});
