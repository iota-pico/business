/**
 * Tests for MultiSigClient.
 */
import { IApiClient } from "@iota-pico/api/dist/interfaces/IApiClient";
import { ITimeService } from "@iota-pico/core/dist/interfaces/ITimeService";
import { Address } from "@iota-pico/data/dist/data/address";
import { AddressSecurity } from "@iota-pico/data/dist/data/addressSecurity";
import { Bundle } from "@iota-pico/data/dist/data/bundle";
import { Hash } from "@iota-pico/data/dist/data/hash";
import { SignatureMessageFragment } from "@iota-pico/data/dist/data/signatureMessageFragment";
import { Tag } from "@iota-pico/data/dist/data/tag";
import { Transaction } from "@iota-pico/data/dist/data/transaction";
import { Transfer } from "@iota-pico/data/dist/data/transfer";
import { Trytes } from "@iota-pico/data/dist/data/trytes";
import * as chai from "chai";
import { BundleHelper } from "../../src/helpers/bundleHelper";
import { MultiSigAddress } from "../../src/multiSig/multiSigAddress";
import { MultiSigClient } from "../../src/multiSig/multiSigClient";

describe("MultiSigClient", () => {
    let apiClientStub: IApiClient;
    let timeServiceStub: ITimeService;

    beforeEach(() => {
        apiClientStub = <IApiClient>{};
        timeServiceStub = <ITimeService>{};
        timeServiceStub.msSinceEpoch =  () => 1518782585;
    });

    it("can be created", () => {
        const obj = new MultiSigClient(apiClientStub);
        chai.should().exist(obj);
    });

    describe("getKey", () => {
        it("can fail with no seed", () => {
            chai.expect(() => MultiSigClient.getKey(undefined, undefined, undefined)).to.throw("The seed");
        });

        it("can fail with no index", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getKey(seed, undefined, undefined)).to.throw("The index");
        });

        it("can fail with invalid index", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getKey(seed, -1, undefined)).to.throw("The index");
        });

        it("can fail with no security", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getKey(seed, 0, undefined)).to.throw("The security");
        });

        it("can fail with invalid security", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getKey(seed, 0, 0)).to.throw("The security");
        });

        it("can succeed", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const ret = MultiSigClient.getKey(seed, 0, AddressSecurity.high);
            // tslint:disable-next-line:max-line-length
            chai.expect(ret.toString()).to.be.equal("UOYHW9QZSZYIJTALEYJOBM9ILWUMRUEM9VKHTVJTMS9AHALZQRXVOMSGGEVSFFQAXURGYGHBBFXEPXZFCLKHSJJIHUNGQRTOJPBCPJNUVQ9GUAFVBENWKGGJHOQADJXMCZIUROERGUKMYGKMVLTUZTPSTRJMX9ZEHCYNZPAHLG9AVNI9HORGSSICGCQYKWYHMVOSUWFVOOXNYQAYUSU9UKP9LDSOBVLQEWCQTKQJO9QTNGUORFCJIHEHTGSMEIPYDROOAJGWVHZTYCXJRCCMQMCICJSAP99TEVCOSRFPVJKOVJDYQSWGUXWNOWGLYZPGEHOZPVRIZK9UNC9LDU9HNGMSKIPIIFAHTPNCSDWMJAPTFGNFPCLILK9CUIFZRMSTSSKYRHCWXRIXHPFUWYSBDOCRBQWFUTSVIPOIJPMURGUODQ9SMRFQYU9JXICFFZDCGCQRXM9VLXX9LQYLNTDXJSGOPCMQXKEZKW9CDXDJM9PEVUTWZEPEWWSSS9H9MDSFSHFAJDRKOUZMNQELMTBLJYVUNWOBFJDOHBRWZ9VAGCQECWNQNCWKWH9GTHXTCAXWKSWT9MMIKSYQAXTITRRHBDUSNTTDMLEPLKOOBTSREAM9RHMPA9FNSEQLCANOTGGXDIVFTNEDJONUYHAHDETJJGXZMRLRBQXDUGGGHQELAPPMLUJLDJBVZEDQ9ICYZUJ9DPWBMGWLHAQLZIDPPT9FPNZSABEKXCJTYXXEOENMPZCKYCZZUNRTJCUMDTVRXHJYORCQMATTODUZPWTOVVYKKCNLZMNZYELEREFQCLNEPBUHAGAXPBZAKWGZRVGVCVXYWCOUTLHOSVSZIHWI99NRGKKVUTRZZFT9VOOEHHGDLRLUUEXXLVAMKWKPVYDGXLXHWS9ZIVYUDVCGQADPNZQNVQDNKLHJ9VOVLPTOCJPJ99UOEA9JNFNEJGILRGHZUHWWRR9YUTXRPLPYUKRQCHKNTILNPMKWODYKQLJIZDBKCWANJQSTHIJAGJDSKNWFQSPDUOMFT9WKJDMJUELCFMMKPDRPVFHIDOSLPDOAELDFCKCCN9BETJIDFDVNFFDRDHKRLUIDZVNBRZMEFTUQQRJDFELJUJOONDKJGNFCYYRJCTDJQXWHDFUIYAP9KEII9CMSXFISHBPZKOASJMFQCTVFILPVMMRXJMDZXCMZDB9VAXMCWIZSTMFPKEFMBQZG9RCCKBCUQIUGCUWWEKWJPGVKQKEXIPATGAOYRLCIIASHCPEFATZKDIVQXNLGADWITFVUMMXGBCJJTOSOZESYTDKZEO99DDJTEFMOFHMEDQWGKRCRVDJKFUATJKAHJAAPKX9ZJTR9DDHVDLRUOSMEIDFENIADVZAPKMCJZKSJ9MLDZFSIDYIIRIZM9YSWZ9APQSOXZJAHFZTGPIKXYVLLVFGDMRMH9IMDHNMWSOMMFGBCNWWOWANAQZOSIVPUGTMCCFLBKANSIZPUJE9BXMBPZAGBAFXXVRECTLSWJW9NRVZGYIZXYCFCAZTNVVWQHVMUQJSAXR9ROHJHIRDFCFXZ9YPNTLB9PGKPPVIGGALCLAHBYDMAMDZFDGEYOBTMRXSOBFQLMTAQSNIPREXOHMOMSBRDQAJIADMYVIUTGTWXZTUIETBZGHLSUZCIZZCIAWFJZGMAEUNYFFEDBHSODGAAWEP9IBBTTGHQDCSYFHZXYXLNEHQKGJBKTOOGEVD9WAZZHCOWOIRY9ZHHJPKBWTAHALCGZ9ZG9IKWBBLTPPIGBAXMFVDATOSIZMNOPCGMQORMHOARDUS9KDWOOLUETWET9XHIIYECFRTJLKCK9DQXTCDOEHRZTTZXPUDBMOHMPLQN9TTGSJCYEKD9SNCZERJJZNJRWSRDXKUEAXAELTGQHUOVQKSZTEZSJJHVKYLHVIKIXQ9GENYHBJFBOHRYJRJXLKDBAQTDDXMAPRFLMXGOAUKPQOALSPGGUQLJMZKXUDQSGO9MTIHHRDZIGLVDYKPLEMC9VFIUZGXQKJNDMTX9CXSDATQFIYTSLHAMBZAN9CWAKBHQGOUDNQYJHWIYLFZJIZRLBSJXXWMZFCFDCS9GKWKGVXRKCPRQHVSLBSXSODAPXSYYVVBUCEPA9KB9MLNBOYAWRNOKTGLWDWTBSQYQIRBKDMPUFYQLZCVJNXZRJHCNBUIB9GPZOAYVL9YHUXNYUITPABAUWDTRA9I9XEAFNKUNMRBXFFSHMOJJCGDTFADXXZJBPFSIGJJNKJBDYYPZQRCEUJO9TKYCZU9WEBKTDCPXZOSYXHMQZ9SGICQWNFPALHNPVZLPHGM9WGBZZFFOKZRJHPGIVKPLB9QXLBBUMWGPSYMDZZVILWXEFXFPYYVLR9DXQLIRLERLRYAGYCPPQA9VEMQZHYUKQMDWJAYXDYBVYXKOVZRYHNTSVCNDEHNBLBKICNTREORH9AEGDC9XZAHHDWPCXXHXPTCNYCUVPJFBESQGMSCOCQBBSIJURLCTKIMIJZIYPFRYFYS9SSXVAHHBMTFRYJUQDJZVZIRHABDKBNAXCYEVGQXFRG9JOWVTWJVAAULOSNATWOWROHDDSH9VRHOVTVYKLIXC9HMRD9GFAZPYUMJOZ9RGQJIZDTAVJIVSDDFCEJFLCO9HVFQR9PGNGEDVJCBGVCELXWTSOEOXTQHKZIZCZUOVLXHAORWOYEWCJQRNIDUYZJYNFONHULHGONWGXQYYKBHJVMNVOQVWJUSREDSWTILSVYTBFWTSBIRXTWPQYPDUPRKZKYCPFPTCRADWAY9MQX9NUGNSEM9TWSGIN9YXGEETPFEB9SUBVBK9OJKICOYFTVKBWNKVRW9X9GNHXHHXPKFHXEOBQLXCUDKXCJLEJBWAEBMFZROPRWDCEXLJ9UFNQLATAHMCLBEEUQZUPIFHPGOXPY9WKXYAFMMHK9UAFTYAZPEKYLUOIQKMHFWEVC9POTJVAZIACRDDPDEKUVJLRKRABATXEFKHAKQVJRXIVIRZZJWIYFJCTUNXWK9LKXCHLUPGDXJTGSU9C9KKUBPLF9JEQHPDLKKIQZXVNVMQJXESUPNYUJYVYGVVBZZHCCUXR9ZAFNMN9SKJOXAQGFBVHVHKS9PJ9IUIBIZNHHXKWHRRCREVBYCMQVRQBJVGFZTJICGFVRZFMYXI9BALCUSZXSKLNOKMZPHYRCEBGDOSVMFQSRWRVOSTPLWIABJNJRZZG9KDNFTJNYEBBWLU9FNOPMASMDAGGPDXVDHTIOOQYDAOXODRDELMWRSDPGEVXWLMDLTIXOHDIUPYFFKNOQVPFQRXI9XSOYZKAXQCG9UE9XWVSEBEWRIMGMLQOCOQKLTVQHGFJQ9VLBQDSBHCTRDFWWLBSCRK9ZDADZUKAKD9GASTUNFBAMJOKDTLSWEOE9RFMZHWJMDSBRNEBSZRFOZQ9MWUSNIFHPJNZGEFUY9HHCTDLET9PCBMTIYMIFBWNBPCGDQCFEKOWXDMUIYSDUBMHYRQVBZJMPPZOKVTKPUKVJJ9MKEXZMSPINNYBE9VVYERXSAJMFHLVZRZFEFOCAXRCBVMDUBYONNWZXECT9TCIEOERVQYTMALZJQUDNFXAGYVDYL9RIDGYOVHEBSNHIWNHEERPLCKMS9XUXYQL9ZFNLMEOCXKCHUOWORWUKLBEWQXIFZOEY9DP9ATXAKOQHDVDUDPDJYDTCZVQKPPAVEACYWEJWHRHYMLSFBEVDLZYWRHLUPOICACPUGWURKAMVXCYEL9YREWFOSZIBYYYPHXLITVDBJGAMNUNVQXOMPPUMCHATNERL9R9HLVPXUFWENHZTYVQNWTXITQJZZDURHMNBEPBPMSJZL9CYVJMLERTXQEZZBJDVHPZKEURGSLYELPJFPPYANSMNKJZCNGDSYD9NAWELECMPOVVHNGCGVKVQCHMZOVFNQEJUPYTV9QSRWZUUYJLKIDLGXTXAHPZYG9GBVXZUJJMBEKOQNOXKUFVYAZCLZMI9GAMTVRVHAAGHTKSU9YCYCX9QDURZZBEUTKFSKCFSCAXR9YD9RGDTG9OUJPYGAUGNLPNXMTWIX9UX9AEDUGNVEGRDCFVZALNWIPMZAXRYOMRHKSESNBTJZZ9MXVXIKFQGIURLGAGLUNCFZKMUUFLOCNWAQZFJJMOGEJFPFZYGOMVBBUYMCYNHXTAINGM9FSYJPRUDQ9GPPRLRDIEHIDTPIDGI99NKXAZMVAPTAYVKKORNNHCNJUZQVLMXVATMKPLWQLODWRHT9USCDBLOUGDYLILSHCQNBKEYGF9ONIVDGWFLS9VEXK9R9OWZVIBGVZ9DXQODKQQQONHTXSH9ADGQNRYLPNSIZGVXPVYJUIXYUIVNWQCMERGZIXOTBJLYMFWWSIEFJWZ9SGVVBLPHPGFCJZKQYQZLRDIIDFYGZUMZKM9RGSODTKSEEPYTYHCULMBXLQCLDKECDTUPVDJUGWCKXIDOXPTDRQIVIMHBDBRWCUZHYYZCJOVSQLFOVKMNBASFPXKTQDSTHPUOEIZJBJDTXGVZFMXAU9XWVKDECUTRMAAX9SKKSKVSJVXUQQGNLCASXOLBJJWVQYHGXF9TJIZHJTPKBNEHYIWXMVRPHMXZSSRHZFNYH9LQIOMUTGA9TAJDDONQGSUZLKUDWUM9B9NRDZHYXR9NZA9JITMETPJYG9LSFIDKCCXMPYNSKENELDQJLMEVPPAKZNRBZYUXGXPUQQUKANQBQLUKGDAMYFPJDAYARSHLGNQXF9MXUKJDRKLCTOPPNOSXCSGINCPXJBVP9UDCNGQFYCXUJZOBZQ9UCGOWRDVOMFYGBMCPCRWJSRMRTHSXOZVBVDBXRGBVJTJ9OFLRVLXKZYYBCPGGCFJDWSPTHYQIASOSQZBJFDBWTSZBEZPQFBBMBERLKYGDA9YTAQICSOLNXRIYCIFFJCIOHQNFGXRWBYQTVDQHNNWY9Y9OETSBLIZBMK9TGHNYYOXXUUEGFI9WARNAZFI9VYIWRPEHQR9WKB9BMDDVJYMOWWJSQWZYPLFPEJCDXKOAGJGUENITXDEUNUSIWDQNUI99YCMRAPTPKICALRGJALSCB9EARQQQBTDZDQWOUSKZEHIMRTODZXYVBOKLYZIALALFVCROLVLYJEKNWXKINMTJN9QHRP9UOQHXMKCXOVYHEORVQPTUKYYVMUHBYKMJKSDQBPXVYZUPDCGSVNYPLKTUDZNOFWDNQFCSAXJEIUQW9YSXFIKWXIAVHYFTCHVGQLJYJBEMCOEUMFMEMS9DDLMZSCHIPYBEDVGMBATBEGVDZOMODXOPUMLDARTHVTYKEIOSQS9KDBXYZCYRYLTKRLCALLWULO9VPFLUVOEBYS9FTBWXHHYUSAOURMAIOAAAPOIBCTUQDXKTFSUQKFWJWCVLINDMITZFHIKRYHPGLRFUACSFNDSBNJRLHWGB99ZJWIMHSUMSCJXMFGPRJWNFQQDHUKAEUQLVNCNTVRFPVIABYAZS9DEDNTOBBHJKFJIDZWOPD9YMBAKJWTCZRW9OIVGHWWLQHWUC99ZJSXSIFD9MEDFGQHBYGQQGJTUQKHRB9RPCKTHNAJLMYHUKDCTVL9CLDHPOYTZJEXXQ9KXZAJFYLPIIGYEVTCDZFBOCDKQXBYUCAFPXIUDMBIPSHINQOXNAXUDBIGHCWDJAJFUTSBRRGAPOXYUYVQODUFUMGISJCMA9FLWAFOXYBQXDIAUAEEJDF9HOGGWXAULAUJDUMOIUNGQRZZWMIORWDTIZOCNYNBXTBZQIOUFPDFTMREBMHVELGMEDITBMOYOKTZXQMPCFQMYYEZRIITWSQRFRHVRJYCPUNAGKQXJPKZWJYPIUYYTVWURNCKMHKGNLLOWYJSTOLNLLI9DJARZZZTKGJVZZMHBELKFKQTSJTZNQXZMVURU9TNYKHMKCFMYOCKWWELCIEKB9CVMSVYGALEXWMNOFYZKVNWWKWFTJWKDKMHGGPJYLUETVWUZ9ELKYJXXSJYMNBUMAFNECOBADCYOILZYNVQAYCABLMQUUZYTZEEZLMNAJDWKIMESNFE9LMRLWCJTJBWQKSJAHSFIWHMENJOCGEXDLMGNDCSPILIEUQ9JD9YLRMIRGDGMDZAZZZFSWLQZROBREAUOXTKUJDOIINNLBYQRKWRETZWHMA9FUFPTRLUGYAYVKMZXGORGUCG9EBVYPTOFDNAMDIPSSRCFDHBDBPKQSAMKVEXMNQTNRRURT9LKDDKUHEZTVISBQAFBYAZDHIFZWKORKPSW9VMEOJT9QJXBBMLGURCQXYLFKYFHJLTVLSQUQEO9ZXXGVYEVKMVEMYYXIQYFFYCZXRRWCPKTYTVEIGUCCFFYXAQUJZWWOCSQBACRPJB9TZWBIPFPEVPXRLPQTODLF9EEBDYJVAQDXDEJEMYSHZPD9CVBCCFEPLV9QHTUVTRFECOKMHXNAFTCIZKAI9PFXNHWJMODFSBQVTCXUPKFBSITRJPNRCOQYYVUDGX9RUXJLW9CXWKUEVXIVVTBYHUWSBMRMBMBBQUCPZRRHCYJOLSVIBWBXVWSVWFYKZGWDDKB9UNTVEWOMUNAYMPX");
        });
    });

    describe("getDigest", () => {
        it("can fail with no seed", () => {
            chai.expect(() => MultiSigClient.getDigest(undefined, undefined, undefined)).to.throw("The seed");
        });

        it("can fail with no index", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getDigest(seed, undefined, undefined)).to.throw("The index");
        });

        it("can fail with invalid index", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getDigest(seed, -1, undefined)).to.throw("The index");
        });

        it("can fail with no security", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getDigest(seed, 0, undefined)).to.throw("The security");
        });

        it("can fail with invalid security", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.getDigest(seed, 0, 0)).to.throw("The security");
        });

        it("can succeed", () => {
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const ret = MultiSigClient.getDigest(seed, 0, AddressSecurity.high);
            // tslint:disable-next-line:max-line-length
            chai.expect(ret.toString()).to.be.equal("THVBU9FCRFDGLAPYXDIRHIAKSMISOOVDCLDQXWSBPXAWSAMXGRGSDUOTWFVSCELAXKLQSKVYLAVRFD9PXQLDBWTLJBTYMIXEPPETEPBNSOJISGE9FMDGEYCPXBXDJNSQVDFPSYMTAXUVOPUHYLGQMGCZY9ITQHEXMB9QEVXZHHFV9SMH9QVRUZXETDXAEJCYVLSFPCZUWDVQZQX9ROPUCFNTDXDQOMAYQOCKCQAABNEUALCWEXC");
        });
    });

    describe("validateAddress", () => {
        it("can fail with no address", () => {
            chai.expect(() => MultiSigClient.validateAddress(undefined, undefined)).to.throw("The address");
        });

        it("can fail with no digests", () => {
            const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
            chai.expect(() => MultiSigClient.validateAddress(address, undefined)).to.throw("The digests");
        });

        it("can succeed when digests don't match", () => {
            const addr1 = Address.fromTrytes(Trytes.fromString("A".repeat(81)));

            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest = MultiSigClient.getDigest(seed, 0, AddressSecurity.high);

            const ret = MultiSigClient.validateAddress(addr1, [digest]);

            chai.expect(ret).to.be.equal(false);
        });

        it("can succeed when digests do match", () => {
            const msAdd = new MultiSigAddress();
            const seed = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest = MultiSigClient.getDigest(seed, 0, AddressSecurity.high);
            const add = msAdd.finalize([digest]);

            const ret = MultiSigClient.validateAddress(add, [digest]);

            chai.expect(ret).to.be.equal(true);
        });
    });

    describe("addSignature", () => {
        it("can fail with no bundle", () => {
            chai.expect(() => MultiSigClient.addSignature(undefined, undefined, undefined)).to.throw("The bundle");
        });

        it("can fail with no bundle transactions", () => {
            chai.expect(() => MultiSigClient.addSignature(new Bundle(), undefined, undefined)).to.throw("The bundle.transactions");
        });

        it("can fail with no address", () => {
            const bundle = new Bundle();
            bundle.transactions = [
                // tslint:disable:max-line-length
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX9JA999999999999999999999999NG9999999999999999999999999EJDWC9999999999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY9QZ999999999999999999999999999999999999999999999999999EJDWC9999A99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999B99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999C99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999D99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999E99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999F99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999"
                ].map(t => Transaction.fromTrytes(Trytes.fromString(t)));
            chai.expect(() => MultiSigClient.addSignature(bundle, undefined, undefined)).to.throw("The address");
        });

        it("can fail with no key", () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const bundle = new Bundle();
            bundle.transactions = [
                // tslint:disable:max-line-length
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX9JA999999999999999999999999NG9999999999999999999999999EJDWC9999999999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY9QZ999999999999999999999999999999999999999999999999999EJDWC9999A99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999B99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999C99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999D99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999E99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999F99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999"
                ].map(t => Transaction.fromTrytes(Trytes.fromString(t)));
            chai.expect(() => MultiSigClient.addSignature(bundle, address, undefined)).to.throw("The key");
        });

        it("can succeed", () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const bundle = new Bundle();
            bundle.transactions = [
                // tslint:disable:max-line-length
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX9JA999999999999999999999999NG9999999999999999999999999EJDWC9999999999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY9QZ999999999999999999999999999999999999999999999999999EJDWC9999A99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999B99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999C99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999D99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999E99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999F99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999"
                ].map(t => Transaction.fromTrytes(Trytes.fromString(t)));

            const key1 = MultiSigClient.getKey(seed1, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key1);

            const key2 = MultiSigClient.getKey(seed2, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key2);

            const isValid = BundleHelper.validateSignatures(bundle, address);
            chai.expect(isValid).to.be.equal(true);
        });

        it("can succeed when reaching remainder bundle", () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const bundle = new Bundle();
            bundle.transactions = [
                // tslint:disable:max-line-length
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX9JA999999999999999999999999NG9999999999999999999999999EJDWC9999999999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY9QZ999999999999999999999999999999999999999999999999999EJDWC9999A99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999B99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999C99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999D99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999E99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999F99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999"
                ].map(t => Transaction.fromTrytes(Trytes.fromString(t)));

            const key1 = MultiSigClient.getKey(seed1, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key1);

            const key2 = MultiSigClient.getKey(seed2, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key2);

            bundle.transactions[bundle.transactions.length - 1].signatureMessageFragment = SignatureMessageFragment.EMPTY;

            const isValid = BundleHelper.validateSignatures(bundle, address);
            chai.expect(isValid).to.be.equal(false);
        });

        it("can return false with non matching address", () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1]);

            const bundle = new Bundle();
            bundle.transactions = [
                // tslint:disable:max-line-length
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX9JA999999999999999999999999NG9999999999999999999999999EJDWC9999999999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY9QZ999999999999999999999999999999999999999999999999999EJDWC9999A99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999B99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999C99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999D99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999E99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
                "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999XBGGCCJSLRWP9SBJSUDCYIA9DEYWFUCRAEVGQFQJACRYVPYPSVAYJHWHDSISULVTCCMXWBMMMPYHHFHEY999999999999999999999999999999999999999999999999999999EJDWC9999F99999999F99999999SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999"
                ].map(t => Transaction.fromTrytes(Trytes.fromString(t)));

            const key1 = MultiSigClient.getKey(seed1, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key1);

            const key2 = MultiSigClient.getKey(seed2, 0, AddressSecurity.high);
            MultiSigClient.addSignature(bundle, address, key2);

            const isValid = BundleHelper.validateSignatures(bundle, address);
            chai.expect(isValid).to.be.equal(false);
        });
    });

    describe("prepareTransfer", () => {
        it("can fail with no address", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                await obj.prepareTransfer(undefined, undefined, undefined, undefined, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("The address");
            }
        });

        it("can fail with no securitySum", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
                await obj.prepareTransfer(address, undefined, undefined, undefined, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("The securitySum");
            }
        });

        it("can fail with no balance", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
                await obj.prepareTransfer(address, 0, undefined, undefined, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("The balance");
            }
        });

        it("can fail with no transfers", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
                await obj.prepareTransfer(address, 0, 0, undefined, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("The transfers");
            }
        });

        it("can fail with invalid remainderAddress", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
                const transfers = [Transfer.fromParams(
                    Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                    999,
                    Trytes.fromString(""),
                    Tag.fromTrytes(Trytes.fromString("")))
                ];
                await obj.prepareTransfer(address, 0, 0, transfers, <any>"123");
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("The remainderAddress");
            }
        });

        it("can fail with no transfer value", async () => {
            const obj = new MultiSigClient(apiClientStub);
            try {
                const address = Address.fromTrytes(Trytes.fromString("A".repeat(81)));
                const transfers = [Transfer.fromParams(
                    Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                    0,
                    Trytes.fromString(""),
                    Tag.fromTrytes(Trytes.fromString("")))
                ];
                await obj.prepareTransfer(address, 0, 0, transfers, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("the transfer does not require a signature");
            }
        });

        it("can fail when remainder address required", async () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const obj = new MultiSigClient(apiClientStub, timeServiceStub);
            const transfers = [Transfer.fromParams(
                Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                999,
                Trytes.fromString(""),
                Tag.fromTrytes(Trytes.fromString("")))
            ];
            try {
                await obj.prepareTransfer(address, 6, 1000, transfers, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("no remainder address was provided");
            }
        });

        it("can succeed with remainder", async () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const obj = new MultiSigClient(apiClientStub, timeServiceStub);
            const transfers = [Transfer.fromParams(
                Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                999,
                Trytes.fromString(""),
                Tag.fromTrytes(Trytes.fromString("")))
            ];
            const remainderAddress = Address.fromTrytes(Trytes.fromString("NZRALDYNVGJWUVLKDWFKJVNYLWQGCWYCURJIIZRLJIKSAIVZSGEYKTZRDBGJLOA9AWYJQB9IPWRAKUC9FBDRZJZXZG"));
            const ret = await obj.prepareTransfer(address, 6, 1000, transfers, remainderAddress);
            chai.expect(ret.transactions.length).to.be.equal(8);
            ret.transactions.forEach(t => {
                chai.expect(t.bundle.toTrytes().toString()).to.be.equal("XFOXLDVGOCIIQJPSYZCNKEWBVTJL9SMNBJFLPRVIDIGU9JZZLKZTDOGVDFXS9KHLEPXUICNI9QXFKOBWX");
            });
        });

        it("can succeed with no remainder", async () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const obj = new MultiSigClient(apiClientStub, timeServiceStub);
            const transfers = [Transfer.fromParams(
                Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                999,
                Trytes.fromString(""),
                Tag.fromTrytes(Trytes.fromString("")))
            ];
            transfers[0].tag = undefined;
            transfers[0].message = undefined;
            const ret = await obj.prepareTransfer(address, 6, 999, transfers, undefined);
            chai.expect(ret.transactions.length).to.be.equal(7);
            ret.transactions.forEach(t => {
                chai.expect(t.bundle.toTrytes().toString()).to.be.equal("SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C");
            });
        });

        it("can succeed when performing getBalances lookup", async () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            apiClientStub.getBalances = () => Promise.resolve({ balances: ["999"], milestone: "0", milestoneIndex: 0, duration: 0 });

            const obj = new MultiSigClient(apiClientStub, timeServiceStub);
            const transfers = [Transfer.fromParams(
                Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                999,
                Trytes.fromString(""),
                Tag.fromTrytes(Trytes.fromString("")))
            ];
            const ret = await obj.prepareTransfer(address, 6, 0, transfers, undefined);
            chai.expect(ret.transactions.length).to.be.equal(7);
            ret.transactions.forEach(t => {
                chai.expect(t.bundle.toTrytes().toString()).to.be.equal("SSXKSGHEJHRILHVVROWPQCUIFJCOFWLCTBLHJNKWUQYAYZWWWFHKENJQYSWRERN9RGETLAYHI9TKK9W9C");
            });
        });

        it("can fail when there is not enough balance for transfer", async () => {
            const seed1 = Hash.fromTrytes(Trytes.fromString("A".repeat(81)));
            const digest1 = MultiSigClient.getDigest(seed1, 0, AddressSecurity.high);
            const seed2 = Hash.fromTrytes(Trytes.fromString("B".repeat(81)));
            const digest2 = MultiSigClient.getDigest(seed2, 0, AddressSecurity.high);

            const multiSigAddress = new MultiSigAddress();
            const address = multiSigAddress.finalize([digest1, digest2]);

            const obj = new MultiSigClient(apiClientStub, timeServiceStub);
            const transfers = [Transfer.fromParams(
                Address.fromTrytes(Trytes.fromString("ZGHXPZYDKXPEOSQTAQOIXEEI9K9YKFKCWKYYTYAUWXK9QZAVMJXWAIZABOXHHNNBJIEBEUQRTBWGLYMTX")),
                999,
                Trytes.fromString(""),
                Tag.fromTrytes(Trytes.fromString("")))
            ];
            try {
                await obj.prepareTransfer(address, 6, 1, transfers, undefined);
                chai.assert("Should not be here");
            } catch (err) {
                chai.expect(err.message).to.contain("Not enough balance");
            }
        });
    });
});
